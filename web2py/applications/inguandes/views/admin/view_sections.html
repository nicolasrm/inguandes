{{extend 'layout.html'}}
<div class="row">
    <div class="span6">
        <h2>Secciones</h2>
        <h3>{{=courseTitle}}</h3>
    </div>
    <div class="span2 offset4">
        <a class="btn btn-success" data-toggle="modal" href="#modal-new-section"><i class="icon-plus icon-white"></i> Crear Sección</a>        
    </div>
</div>

<div class="row">
    <div class="span10 offset1">
        {{ if len(sections) > 0: }}
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>NRC</th>
                    <th>Semestre</th>
                    <th>Alumnos</th>
                    <th>Ayudantes</th>
                    <th>Ay. Jefe</th>
                    <th>Profesores</th>
                    <th></th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {{ for s in sections: }}
                <tr>
                    <td>{{=s['nrc']}}</td>
                    <td>{{=s['term_name']}}</td>
                    <td><a class="badge badge-inverse" href="#">{{=s['students']}}</a></td>
                    <td><a class="badge badge-inverse" href="#">{{=s['assistants']}}</a></td>
                    <td><a class="badge badge-inverse" href="#">{{=s['assistants_boss']}}</a></td>
                    <td><a class="badge badge-inverse" href="#">{{=s['professors']}}</a></td>
                    <td><a data-btn-type="new-relation" data-section-id="{{=s['id']}}" data-section-nrc="{{=s['nrc']}}" class="btn btn-success" rel="tooltip" title="Asociar nuevo usuario a la sección" href="#"><i class="icon-plus icon-white"></i><i class="icon-user icon-white"></i></a></td>
                    <td><a data-btn-type="edit" data-section-id="{{=s['id']}}" data-section-nrc="{{=s['nrc']}}" data-section-term="{{=s['term']}}" class="btn btn-primary" rel="tooltip" title="Editar sección" href="#"><i class="icon-edit icon-white"></i></a></td>
                    <td><a data-btn-type="delete" data-section-id="{{=s['id']}}" data-section-nrc="{{=s['nrc']}}" class="btn btn-danger" rel="tooltip" title="Eliminar sección" href="#"><i class="icon-remove icon-white"></i></a></td>
                </tr>
                {{ pass }}
            </tbody>
        </table>
        {{ else: }}
            <h4>No hay secciones para este curso.</h4>
        {{ pass }}
    </div>
</div>
<div class="modal hide fade in" id="modal-new-section">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">x</button>
        <h3>Crear nueva sección</h3>
        <h4>{{=courseTitle}}</h4>
    </div>
    <div class="modal-body">
        <form class="form-horizontal" action="{{=URL('add_section')}}" method="POST">
            <fieldset>
                <div class="control-group">
                    <label class="control-label" for="nrc">NRC</label>
                    <div class="controls">
                        <input type="text" id="nrc" name="nrc"/>
                        <p class="help-block">Código único que identifica la sección.</p>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="nrc">Email</label>
                    <div class="controls">
                        <input type="text" id="email" name="email"/>
                        <p class="help-block">Correo electrónico del curso.</p>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="term">Semestre</label>
                    <div class="controls">
                        <select id="term" name="term">
                        {{ for term in terms: }}
                            <option value="{{=term.id}}">{{=term.name}}</option>
                        {{ pass }}
                        </select>
                        <p class="help-block">Semestre al cual pertenece la sección.</p>
                    </div>
                </div>                
                <input type="hidden" class="course-id" name="courseid" value="{{=the_course.id}}" />
            </fieldset>
        </form>
    </div>
    <div class="modal-footer">
        <a href="#" class="btn" data-dismiss="modal">Cerrar</a>
        <a href="#" class="btn btn-primary modal-action">Crear</a>
    </div>
</div>

<div class="modal hide fade in" id="modal-edit-section">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">x</button>
        <h3>Editar sección</h3>
        <h4>{{=courseTitle}}</h4>
    </div>
    <div class="modal-body">
        <form class="form-horizontal" action="{{=URL('edit_section')}}" method="POST">
            <fieldset>
                <div class="control-group">
                    <label class="control-label" for="nrc">NRC</label>
                    <div class="controls">
                        <input type="text" id="edit-nrc" name="nrc"/>
                        <p class="help-block">Código único que identifica la sección.</p>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="term">Semestre</label>
                    <div class="controls">
                        <select id="edit-term" name="term">
                        {{ for term in terms: }}
                            <option value="{{=term.id}}">{{=term.name}}</option>
                        {{ pass }}
                        </select>
                        <p class="help-block">Semestre al cual pertenece la sección.</p>
                    </div>
                </div>                
                <input type="hidden" class="course-id" name="courseid" value="{{=the_course.id}}" />
                <input type="hidden" class="section-id" name="sectionid" />
            </fieldset>
        </form>
    </div>
    <div class="modal-footer">
        <a href="#" class="btn" data-dismiss="modal">Cerrar</a>
        <a href="#" class="btn btn-primary modal-action">Editar</a>
    </div>
</div>

<div class="modal hide fade in" id="modal-delete-section">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">x</button>
        <h3>Eliminar sección</h3>
        <h4>{{=courseTitle}}</h4>
    </div>
    <div class="modal-body">
        <p>¿Está seguro que desea borrar la sección <b><span id="delete-section-name"></span></b>?</p>
        <form action="{{=URL('delete_section')}}" method="POST">
            <input type="hidden" class="course-id" name="courseid" value="{{=the_course.id}}" />
            <input type="hidden" class="section-id" name="sectionid" />            
        </form>
    </div>
    <div class="modal-footer">
        <a href="#" class="btn" data-dismiss="modal">Cerrar</a>
        <a href="#" class="btn btn-primary modal-action">Eliminar</a>
    </div>
</div>

<div class="modal hide fade in" id="modal-new-relation">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">x</button>
        <h3>Agregar usuario a sección</h3>
        <h4>{{=courseTitle}} - <span id="new-relation-section"></span></h4>
    </div>
    <div class="modal-body">
        <form class="form-horizontal" action="{{=URL('add_relation')}}" method="POST">
            <fieldset>
                <div class="control-group">
                    <label class="control-label" for="user_email">Email</label>
                    <div class="controls">
                        <input type="text" id="user_email" name="user_email"/>
                        <p class="help-block">Correo electrónico @miuandes.cl del usuario.</p>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="user_role">Rol</label>
                    <div class="controls">
                        <select id="user_role" name="user_role">
                        {{ for (k,v) in user_roles.iteritems(): }}
                            <option value="{{=k}}">{{=v}}</option>
                        {{ pass }}
                        </select>
                        <p class="help-block">Rol que tendrá el usuario en esta sección.</p>
                    </div>
                </div>
                <input type="hidden" class="course-id" name="courseid" value="{{=the_course.id}}" />
                <input type="hidden" class="section-id" name="sectionid" />
            </fieldset>
        </form>
    </div>
    <div class="modal-footer">
        <a href="#" class="btn" data-dismiss="modal">Cerrar</a>
        <a href="#" class="btn btn-primary modal-action">Agregar</a>
    </div>
</div>

{{block pagescripts}}
<script>
$(document).ready( function () {
    $("[rel=tooltip]").tooltip({placement: 'top'});
    
    $('.modal .modal-action').click( function () {
        $(this).closest('.modal').find('form').submit();
    });
    
    $('[data-btn-type="edit"]').click( function ( event ) {
        var modal, sectionId, sectionNRC, sectionTerm;
        
        data = $(event.currentTarget).data();
        sectionId = data.sectionId;
        sectionNRC = data.sectionNrc;
        sectionTerm = data.sectionTerm;
        
        modal = $('#modal-edit-section');
        modal.find('#edit-nrc').val(sectionNRC);
        modal.find('#edit-term').val(sectionTerm);
        modal.find('.section-id').val(sectionId);
        
        modal.modal('show');
    });
    
    $('[data-btn-type="delete"]').click( function ( event ) {
        var modal, sectionId, sectionNRC;
        
        data = $(event.currentTarget).data();
        sectionId = data.sectionId;
        sectionNRC = data.sectionNrc;
        
        modal = $('#modal-delete-section');
        modal.find('#delete-section-name').text(sectionNRC);
        modal.find('.section-id').val(sectionId);
        
        modal.modal('show');
    });
    
    $('[data-btn-type="new-relation"]').click( function ( event ) {
        var modal, sectionId, sectionNRC;
        
        data = $(event.currentTarget).data();
        sectionId = data.sectionId;
        sectionNRC = data.sectionNrc;
        
        modal = $('#modal-new-relation');
        modal.find('#new-relation-section').text(sectionNRC);
        modal.find('.section-id').val(sectionId);
        
        modal.modal('show');
    });
});
</script>
{{end}}



